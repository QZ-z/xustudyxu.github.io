<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Spring5 事务 | 个人博客</title>
    <meta name="generator" content="VuePress 1.9.7">
    <link rel="icon" href="/Blog/img/01.favicon">
    <link rel="stylesheet" href="/Blog/css/style.css">
    <script charset="utf-8" href="/Blog/js/main.js"></script>
    <meta name="description" content="纸上得带终觉浅,绝知此事要躬行">
    
    <link rel="preload" href="/Blog/assets/css/0.styles.2a618149.css" as="style"><link rel="preload" href="/Blog/assets/js/app.8c5833f4.js" as="script"><link rel="preload" href="/Blog/assets/js/3.65910f85.js" as="script"><link rel="preload" href="/Blog/assets/js/44.31c4d3cb.js" as="script"><link rel="preload" href="/Blog/assets/js/71.87eb04f3.js" as="script"><link rel="prefetch" href="/Blog/assets/js/10.81cdba43.js"><link rel="prefetch" href="/Blog/assets/js/100.f9fcd96f.js"><link rel="prefetch" href="/Blog/assets/js/101.d0a5d9e0.js"><link rel="prefetch" href="/Blog/assets/js/102.f1e62e87.js"><link rel="prefetch" href="/Blog/assets/js/103.36d86749.js"><link rel="prefetch" href="/Blog/assets/js/104.a3fed4ae.js"><link rel="prefetch" href="/Blog/assets/js/11.84327180.js"><link rel="prefetch" href="/Blog/assets/js/12.17d9ca8d.js"><link rel="prefetch" href="/Blog/assets/js/13.1e830a5c.js"><link rel="prefetch" href="/Blog/assets/js/14.f517f037.js"><link rel="prefetch" href="/Blog/assets/js/15.69fcf12f.js"><link rel="prefetch" href="/Blog/assets/js/16.aa4f87ad.js"><link rel="prefetch" href="/Blog/assets/js/17.eb413a99.js"><link rel="prefetch" href="/Blog/assets/js/18.c7f675dc.js"><link rel="prefetch" href="/Blog/assets/js/19.1ad65747.js"><link rel="prefetch" href="/Blog/assets/js/2.c804ae14.js"><link rel="prefetch" href="/Blog/assets/js/20.ad0a6aed.js"><link rel="prefetch" href="/Blog/assets/js/21.05451fff.js"><link rel="prefetch" href="/Blog/assets/js/22.97f87464.js"><link rel="prefetch" href="/Blog/assets/js/23.6187bcc3.js"><link rel="prefetch" href="/Blog/assets/js/24.5efd4f01.js"><link rel="prefetch" href="/Blog/assets/js/25.72d75945.js"><link rel="prefetch" href="/Blog/assets/js/26.77e4fa87.js"><link rel="prefetch" href="/Blog/assets/js/27.f3400906.js"><link rel="prefetch" href="/Blog/assets/js/28.af630add.js"><link rel="prefetch" href="/Blog/assets/js/29.64dd6a74.js"><link rel="prefetch" href="/Blog/assets/js/30.20fab7fa.js"><link rel="prefetch" href="/Blog/assets/js/31.97852703.js"><link rel="prefetch" href="/Blog/assets/js/32.ec619554.js"><link rel="prefetch" href="/Blog/assets/js/33.53d05166.js"><link rel="prefetch" href="/Blog/assets/js/34.8eaf5933.js"><link rel="prefetch" href="/Blog/assets/js/35.a9ae4789.js"><link rel="prefetch" href="/Blog/assets/js/36.9315a889.js"><link rel="prefetch" href="/Blog/assets/js/37.550c69d5.js"><link rel="prefetch" href="/Blog/assets/js/38.6780cc44.js"><link rel="prefetch" href="/Blog/assets/js/39.5b940e90.js"><link rel="prefetch" href="/Blog/assets/js/4.3f0a58fc.js"><link rel="prefetch" href="/Blog/assets/js/40.25529cbc.js"><link rel="prefetch" href="/Blog/assets/js/41.23a5a65a.js"><link rel="prefetch" href="/Blog/assets/js/42.e826c05e.js"><link rel="prefetch" href="/Blog/assets/js/43.7cd04767.js"><link rel="prefetch" href="/Blog/assets/js/45.59b5ae23.js"><link rel="prefetch" href="/Blog/assets/js/46.1411870b.js"><link rel="prefetch" href="/Blog/assets/js/47.99374a4f.js"><link rel="prefetch" href="/Blog/assets/js/48.b4246cc1.js"><link rel="prefetch" href="/Blog/assets/js/49.d0496971.js"><link rel="prefetch" href="/Blog/assets/js/5.8edcf0df.js"><link rel="prefetch" href="/Blog/assets/js/50.ff075220.js"><link rel="prefetch" href="/Blog/assets/js/51.e3d89f6f.js"><link rel="prefetch" href="/Blog/assets/js/52.c2631e97.js"><link rel="prefetch" href="/Blog/assets/js/53.57560e23.js"><link rel="prefetch" href="/Blog/assets/js/54.83f926dc.js"><link rel="prefetch" href="/Blog/assets/js/55.f1d2b2df.js"><link rel="prefetch" href="/Blog/assets/js/56.abe4c350.js"><link rel="prefetch" href="/Blog/assets/js/57.f200ccef.js"><link rel="prefetch" href="/Blog/assets/js/58.da625c3a.js"><link rel="prefetch" href="/Blog/assets/js/59.fa0b97d1.js"><link rel="prefetch" href="/Blog/assets/js/6.74c5fcb0.js"><link rel="prefetch" href="/Blog/assets/js/60.4b8135d2.js"><link rel="prefetch" href="/Blog/assets/js/61.6f3cefa0.js"><link rel="prefetch" href="/Blog/assets/js/62.3ec3dfad.js"><link rel="prefetch" href="/Blog/assets/js/63.87b92011.js"><link rel="prefetch" href="/Blog/assets/js/64.82a633ab.js"><link rel="prefetch" href="/Blog/assets/js/65.f553c37b.js"><link rel="prefetch" href="/Blog/assets/js/66.dc4b36ca.js"><link rel="prefetch" href="/Blog/assets/js/67.cc6954ce.js"><link rel="prefetch" href="/Blog/assets/js/68.d68da5a8.js"><link rel="prefetch" href="/Blog/assets/js/69.238fecf1.js"><link rel="prefetch" href="/Blog/assets/js/7.5c20a63a.js"><link rel="prefetch" href="/Blog/assets/js/70.f00b6327.js"><link rel="prefetch" href="/Blog/assets/js/72.305d511f.js"><link rel="prefetch" href="/Blog/assets/js/73.eb7b4715.js"><link rel="prefetch" href="/Blog/assets/js/74.354f19bc.js"><link rel="prefetch" href="/Blog/assets/js/75.acb64b9c.js"><link rel="prefetch" href="/Blog/assets/js/76.bd33e776.js"><link rel="prefetch" href="/Blog/assets/js/77.c396a9be.js"><link rel="prefetch" href="/Blog/assets/js/78.b3c14e14.js"><link rel="prefetch" href="/Blog/assets/js/79.7cfa3193.js"><link rel="prefetch" href="/Blog/assets/js/8.abf6cd10.js"><link rel="prefetch" href="/Blog/assets/js/80.fdeb83a7.js"><link rel="prefetch" href="/Blog/assets/js/81.92582601.js"><link rel="prefetch" href="/Blog/assets/js/82.a376b9de.js"><link rel="prefetch" href="/Blog/assets/js/83.2f1ab9ac.js"><link rel="prefetch" href="/Blog/assets/js/84.59c1a4e4.js"><link rel="prefetch" href="/Blog/assets/js/85.134b67c9.js"><link rel="prefetch" href="/Blog/assets/js/86.007a20e0.js"><link rel="prefetch" href="/Blog/assets/js/87.ee00e97a.js"><link rel="prefetch" href="/Blog/assets/js/88.4799e06b.js"><link rel="prefetch" href="/Blog/assets/js/89.a39f5912.js"><link rel="prefetch" href="/Blog/assets/js/9.04f35ee9.js"><link rel="prefetch" href="/Blog/assets/js/90.062e6162.js"><link rel="prefetch" href="/Blog/assets/js/91.5e960f80.js"><link rel="prefetch" href="/Blog/assets/js/92.00225e56.js"><link rel="prefetch" href="/Blog/assets/js/93.55db8078.js"><link rel="prefetch" href="/Blog/assets/js/94.a9f0f665.js"><link rel="prefetch" href="/Blog/assets/js/95.cc7419a1.js"><link rel="prefetch" href="/Blog/assets/js/96.1c787583.js"><link rel="prefetch" href="/Blog/assets/js/97.242178c7.js"><link rel="prefetch" href="/Blog/assets/js/98.3fd83459.js"><link rel="prefetch" href="/Blog/assets/js/99.bef3deb4.js">
    <link rel="stylesheet" href="/Blog/assets/css/0.styles.2a618149.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/Blog/" class="home-link router-link-active"><!----> <span class="site-name">个人博客</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Java全栈" class="dropdown-title"><span class="title">Java全栈</span> <span class="arrow down"></span></button> <button type="button" aria-label="Java全栈" class="mobile-dropdown-title"><span class="title">Java全栈</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          Java基础
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/Blog/studynotes/Java/one/" class="nav-link">
  JavaSE
</a></li></ul></li><li class="dropdown-item"><h4>
          JavaWeb
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/Blog/studynotes/Servlet/one/" class="nav-link">
  Servlet
</a></li></ul></li><li class="dropdown-item"><h4>
          主流框架
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/Blog/studynotes/Spring5/one/" class="nav-link">
  Spring5
</a></li><li class="dropdown-subitem"><a href="/Blog/studynotes/SpringMVC/one/" class="nav-link">
  SpringMVC
</a></li><li class="dropdown-subitem"><a href="/Blog/studynotes/Mybatis/one/" class="nav-link">
  Mybatis
</a></li></ul></li><li class="dropdown-item"><h4>
          项目管理
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/Blog/studynotes/Maven/one/" class="nav-link">
  Maven
</a></li></ul></li><li class="dropdown-item"><h4>
          数据库
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/Blog/studynotes/MySQL/one/" class="nav-link">
  MySQL
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="大数据" class="dropdown-title"><span class="title">大数据</span> <span class="arrow down"></span></button> <button type="button" aria-label="大数据" class="mobile-dropdown-title"><span class="title">大数据</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          Python
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/Blog/studynotes/Python/one/" class="nav-link">
  Python基础
</a></li><li class="dropdown-subitem"><a href="/Blog/studynotes/dataCleaning/one/" class="nav-link">
  数据分析
</a></li></ul></li><li class="dropdown-item"><h4>
          数据库
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/Blog/studynotes/MySQL/one/" class="nav-link">
  MySQL
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="操作系统" class="dropdown-title"><span class="title">操作系统</span> <span class="arrow down"></span></button> <button type="button" aria-label="操作系统" class="mobile-dropdown-title"><span class="title">操作系统</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Blog/studynotes/Linux/one/" class="nav-link">
  Linux
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="面试宝典" class="dropdown-title"><span class="title">面试宝典</span> <span class="arrow down"></span></button> <button type="button" aria-label="面试宝典" class="mobile-dropdown-title"><span class="title">面试宝典</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Blog/baodian/zero/" class="nav-link">
  初级开发篇
</a></li><li class="dropdown-item"><!----> <a href="/Blog/baodian/high/" class="nav-link">
  中高进阶篇
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="工具箱" class="dropdown-title"><span class="title">工具箱</span> <span class="arrow down"></span></button> <button type="button" aria-label="工具箱" class="mobile-dropdown-title"><span class="title">工具箱</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          帮助手册
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="https://docs.oracle.com/javase/8/docs/api/index.html" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Java SE 8参考手册
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-subitem"><a href="https://dev.mysql.com/doc/refman/5.7/en/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  MySQL5.7参考手册
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></li><li class="dropdown-item"><h4>
          在线编辑
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="https://tinypng.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  图片压缩
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></li><li class="dropdown-item"><h4>
          在线服务
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="https://www.aliyun.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  阿里云
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-subitem"><a href="https://cloud.tencent.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  腾讯云
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></li><li class="dropdown-item"><h4>
          博客指南
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="https://juejin.im/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  掘金
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-subitem"><a href="https://blog.csdn.net/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  CSDN
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Java全栈" class="dropdown-title"><span class="title">Java全栈</span> <span class="arrow down"></span></button> <button type="button" aria-label="Java全栈" class="mobile-dropdown-title"><span class="title">Java全栈</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          Java基础
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/Blog/studynotes/Java/one/" class="nav-link">
  JavaSE
</a></li></ul></li><li class="dropdown-item"><h4>
          JavaWeb
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/Blog/studynotes/Servlet/one/" class="nav-link">
  Servlet
</a></li></ul></li><li class="dropdown-item"><h4>
          主流框架
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/Blog/studynotes/Spring5/one/" class="nav-link">
  Spring5
</a></li><li class="dropdown-subitem"><a href="/Blog/studynotes/SpringMVC/one/" class="nav-link">
  SpringMVC
</a></li><li class="dropdown-subitem"><a href="/Blog/studynotes/Mybatis/one/" class="nav-link">
  Mybatis
</a></li></ul></li><li class="dropdown-item"><h4>
          项目管理
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/Blog/studynotes/Maven/one/" class="nav-link">
  Maven
</a></li></ul></li><li class="dropdown-item"><h4>
          数据库
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/Blog/studynotes/MySQL/one/" class="nav-link">
  MySQL
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="大数据" class="dropdown-title"><span class="title">大数据</span> <span class="arrow down"></span></button> <button type="button" aria-label="大数据" class="mobile-dropdown-title"><span class="title">大数据</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          Python
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/Blog/studynotes/Python/one/" class="nav-link">
  Python基础
</a></li><li class="dropdown-subitem"><a href="/Blog/studynotes/dataCleaning/one/" class="nav-link">
  数据分析
</a></li></ul></li><li class="dropdown-item"><h4>
          数据库
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/Blog/studynotes/MySQL/one/" class="nav-link">
  MySQL
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="操作系统" class="dropdown-title"><span class="title">操作系统</span> <span class="arrow down"></span></button> <button type="button" aria-label="操作系统" class="mobile-dropdown-title"><span class="title">操作系统</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Blog/studynotes/Linux/one/" class="nav-link">
  Linux
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="面试宝典" class="dropdown-title"><span class="title">面试宝典</span> <span class="arrow down"></span></button> <button type="button" aria-label="面试宝典" class="mobile-dropdown-title"><span class="title">面试宝典</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Blog/baodian/zero/" class="nav-link">
  初级开发篇
</a></li><li class="dropdown-item"><!----> <a href="/Blog/baodian/high/" class="nav-link">
  中高进阶篇
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="工具箱" class="dropdown-title"><span class="title">工具箱</span> <span class="arrow down"></span></button> <button type="button" aria-label="工具箱" class="mobile-dropdown-title"><span class="title">工具箱</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          帮助手册
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="https://docs.oracle.com/javase/8/docs/api/index.html" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Java SE 8参考手册
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-subitem"><a href="https://dev.mysql.com/doc/refman/5.7/en/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  MySQL5.7参考手册
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></li><li class="dropdown-item"><h4>
          在线编辑
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="https://tinypng.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  图片压缩
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></li><li class="dropdown-item"><h4>
          在线服务
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="https://www.aliyun.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  阿里云
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-subitem"><a href="https://cloud.tencent.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  腾讯云
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></li><li class="dropdown-item"><h4>
          博客指南
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="https://juejin.im/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  掘金
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-subitem"><a href="https://blog.csdn.net/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  CSDN
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Spring5 入门案例</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Spring5 核心之控制反转IOC</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Spring5 核心之面向切面编程AOP</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Spring5 JdbcTemplate操作数据库</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Spring5 事务</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/Blog/studynotes/Spring5/affair.html" aria-current="page" class="active sidebar-link">Spring5 事务</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Blog/studynotes/Spring5/affair.html#事务概念" class="sidebar-link">事务概念</a></li><li class="sidebar-sub-header"><a href="/Blog/studynotes/Spring5/affair.html#搭建事务操作环境" class="sidebar-link">搭建事务操作环境</a></li><li class="sidebar-sub-header"><a href="/Blog/studynotes/Spring5/affair.html#spring-事务管理介绍" class="sidebar-link">Spring 事务管理介绍</a></li><li class="sidebar-sub-header"><a href="/Blog/studynotes/Spring5/affair.html#注解声明式事务管理" class="sidebar-link">注解声明式事务管理</a></li><li class="sidebar-sub-header"><a href="/Blog/studynotes/Spring5/affair.html#注解声明式事务管理参数配置" class="sidebar-link">注解声明式事务管理参数配置</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Blog/studynotes/Spring5/affair.html#propagation-事务传播行为" class="sidebar-link">propagation：事务传播行为</a></li><li class="sidebar-sub-header"><a href="/Blog/studynotes/Spring5/affair.html#isolation-事务隔离级别" class="sidebar-link">isolation：事务隔离级别</a></li><li class="sidebar-sub-header"><a href="/Blog/studynotes/Spring5/affair.html#timeout-超时时间" class="sidebar-link">timeout：超时时间</a></li><li class="sidebar-sub-header"><a href="/Blog/studynotes/Spring5/affair.html#readonly-是否只读" class="sidebar-link">readOnly：是否只读</a></li><li class="sidebar-sub-header"><a href="/Blog/studynotes/Spring5/affair.html#rolibackfor-回滚" class="sidebar-link">rolibackFor：回滚</a></li><li class="sidebar-sub-header"><a href="/Blog/studynotes/Spring5/affair.html#norollbackfor-不回滚" class="sidebar-link">noRollbackFor：不回滚</a></li></ul></li><li class="sidebar-sub-header"><a href="/Blog/studynotes/Spring5/affair.html#xml声明式声明式事务管理-了解" class="sidebar-link">XML声明式声明式事务管理(了解)</a></li><li class="sidebar-sub-header"><a href="/Blog/studynotes/Spring5/affair.html#完全注解开发" class="sidebar-link">完全注解开发</a></li></ul></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Spring5 新功能</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="spring5-事务"><a href="#spring5-事务" class="header-anchor">#</a> Spring5 事务</h1> <p></p><div class="table-of-contents"><ul><li><a href="#事务概念">事务概念</a></li><li><a href="#搭建事务操作环境">搭建事务操作环境</a></li><li><a href="#spring-事务管理介绍">Spring 事务管理介绍</a></li><li><a href="#注解声明式事务管理">注解声明式事务管理</a></li><li><a href="#注解声明式事务管理参数配置">注解声明式事务管理参数配置</a><ul><li><a href="#propagation-事务传播行为">propagation：事务传播行为</a></li><li><a href="#isolation-事务隔离级别">isolation：事务隔离级别</a></li><li><a href="#timeout-超时时间">timeout：超时时间</a></li><li><a href="#readonly-是否只读">readOnly：是否只读</a></li><li><a href="#rolibackfor-回滚">rolibackFor：回滚</a></li><li><a href="#norollbackfor-不回滚">noRollbackFor：不回滚</a></li></ul></li><li><a href="#xml声明式声明式事务管理-了解">XML声明式声明式事务管理(了解)</a></li><li><a href="#完全注解开发">完全注解开发</a></li></ul></div><p></p> <h2 id="事务概念"><a href="#事务概念" class="header-anchor">#</a> 事务概念</h2> <ol><li><p>什么是事务</p> <ol><li><font color="#DC4040" size="4" face="黑体">事务是数据库操作最基本的单元，逻辑上一组操作，要么都成功，如果有一个失败所有操作都失败</font></li> <li>典型场景:银行转账</li></ol> <ul><li>lucy转账100元给mary</li> <li>lucy少100,mary多100</li></ul></li> <li><p>事务四个特性(ACID)</p> <ol><li>原子性</li> <li>一致性</li> <li>隔离性</li> <li>持久性</li></ol></li></ol> <h2 id="搭建事务操作环境"><a href="#搭建事务操作环境" class="header-anchor">#</a> 搭建事务操作环境</h2> <p><img src="/Blog/assets/img/01.9ef9b3e1.png" alt="1641268064900"></p> <ol><li><p>创建数据库表,添加数据</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> t_account<span class="token punctuation">(</span>
	id <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
	username <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
	money <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> t_account <span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token string">'1'</span><span class="token punctuation">,</span><span class="token string">'lucy'</span><span class="token punctuation">,</span><span class="token number">1000</span><span class="token punctuation">)</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> t_account <span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token string">'2'</span><span class="token punctuation">,</span><span class="token string">'mary'</span><span class="token punctuation">,</span><span class="token number">1000</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div></li> <li><p>创建service,搭建dao,完成对象创建和注入关系</p> <ol><li><p>service注入dao,在dao注入JdbcTemplate,在JdbcTemplate注入DataSource</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Service</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserService</span> <span class="token punctuation">{</span>

    <span class="token comment">//注入dao</span>
    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">UserDao</span> userDao<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Repository</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserDaoImpl</span> <span class="token keyword">implements</span> <span class="token class-name">UserDao</span><span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">JdbcTemplate</span> jdbcTemplate<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div></li></ol></li> <li><p>在dao创建两个方法，多钱和少钱的方法，在service创建方法(转账的方法)</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Repository</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserDaoImpl</span> <span class="token keyword">implements</span> <span class="token class-name">UserDao</span><span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">JdbcTemplate</span> jdbcTemplate<span class="token punctuation">;</span>

    <span class="token comment">//少钱</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">reduceMoney</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

        <span class="token class-name">String</span> sql<span class="token operator">=</span><span class="token string">&quot;update t_account set money=money-? where username=?&quot;</span><span class="token punctuation">;</span>
        jdbcTemplate<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>sql<span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">,</span><span class="token string">&quot;lucy&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


    <span class="token punctuation">}</span>

    <span class="token comment">//多钱</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">addMoney</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

        <span class="token class-name">String</span> sql<span class="token operator">=</span><span class="token string">&quot;update t_account set money=money+? where username=?&quot;</span><span class="token punctuation">;</span>
        jdbcTemplate<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>sql<span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">,</span><span class="token string">&quot;mary&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span>



</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br></div></div><div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Service</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserService</span> <span class="token punctuation">{</span>

    <span class="token comment">//注入dao</span>
    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">UserDao</span> userDao<span class="token punctuation">;</span>

    <span class="token comment">//转账的方法</span>
    <span class="token keyword">public</span>  <span class="token keyword">void</span>  <span class="token function">accountMoney</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>

        <span class="token comment">//lucy少100</span>
        userDao<span class="token punctuation">.</span><span class="token function">reduceMoney</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//mary多100</span>
        userDao<span class="token punctuation">.</span><span class="token function">addMoney</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div></li> <li><p>上面代码，如果正常执行没有问题的，但是如果代码执行过程中出现异常,有问题</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">//转账的方法</span>
    <span class="token keyword">public</span>  <span class="token keyword">void</span>  <span class="token function">accountMoney</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>

        <span class="token comment">//lucy少100</span>
        userDao<span class="token punctuation">.</span><span class="token function">reduceMoney</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//模拟异常</span>
        <span class="token keyword">int</span> i <span class="token operator">=</span><span class="token number">10</span><span class="token operator">/</span><span class="token number">0</span><span class="token punctuation">;</span>

        <span class="token comment">//mary多100</span>
        userDao<span class="token punctuation">.</span><span class="token function">addMoney</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">//结果lucy少了100，而mary并没有增加100</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><ol><li><p>上面问题如何解决呢</p> <ul><li>使用事务进行解决</li></ul></li> <li><p>事务操作</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code>    <span class="token comment">//转账的方法</span>
    <span class="token keyword">public</span>  <span class="token keyword">void</span>  <span class="token function">accountMoney</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>

            <span class="token comment">//第一步 开启事务</span>

            <span class="token comment">//第二步进行业务操作</span>
            <span class="token comment">//lucy少100</span>
            userDao<span class="token punctuation">.</span><span class="token function">reduceMoney</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">//模拟异常</span>
            <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">10</span> <span class="token operator">/</span> <span class="token number">0</span><span class="token punctuation">;</span>

            <span class="token comment">//mary多100</span>
            userDao<span class="token punctuation">.</span><span class="token function">addMoney</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">//第三步 没有发生异常，提交事务</span>
        <span class="token punctuation">}</span><span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span><span class="token punctuation">{</span>

            <span class="token comment">//第四步 出现异常，事务回滚</span>

        <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div></li></ol></li></ol> <h2 id="spring-事务管理介绍"><a href="#spring-事务管理介绍" class="header-anchor">#</a> Spring 事务管理介绍</h2> <ol><li><p><strong>事务添加到JavaEE三层结构里面Service层(业务逻辑层)</strong></p></li> <li><p>在Spring进行事务管理操作</p> <ol><li>有两种方式:编程式事务管理和声明式事务管理(使用)</li></ol></li> <li><p>声明式事务管理</p> <ol><li>基于注解方式(使用)</li> <li>基于xml配置文件方式</li></ol></li> <li><p>在Spring进行声明式事务管理，底层使用AOP</p></li> <li><p>Spring事务管理API</p> <ol><li>提供一个接口，代表事务管理器，这个接口针对不同的框架提供不同的实现类</li></ol> <p><img src="/Blog/assets/img/02.bcbab3ca.png" alt="1641285181807"></p></li></ol> <h2 id="注解声明式事务管理"><a href="#注解声明式事务管理" class="header-anchor">#</a> 注解声明式事务管理</h2> <ol><li><p>在Spring:配置文件配置事务管理器</p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code> <span class="token comment">&lt;!--创建事务管理器--&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>transactionManager<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>org.springframework.jdbc.datasource.DataSourceTransactionManager<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!--注入数据源--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>dataSource<span class="token punctuation">&quot;</span></span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>dataSource<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div></li> <li><p>在Spring配置文件，开启事务注解</p> <ol><li><p>在Spring配置文件引入名称空间tx</p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>beans</span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.springframework.org/schema/beans<span class="token punctuation">&quot;</span></span>
       <span class="token attr-name"><span class="token namespace">xmlns:</span>xsi</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.w3.org/2001/XMLSchema-instance<span class="token punctuation">&quot;</span></span>
       <span class="token attr-name"><span class="token namespace">xmlns:</span>context</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.springframework.org/schema/context<span class="token punctuation">&quot;</span></span>
       <span class="token attr-name"><span class="token namespace">xmlns:</span>aop</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.springframework.org/schema/aop<span class="token punctuation">&quot;</span></span>
       <span class="token attr-name"><span class="token namespace">xmlns:</span>tx</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.springframework.org/schema/tx<span class="token punctuation">&quot;</span></span>
       <span class="token attr-name"><span class="token namespace">xsi:</span>schemaLocation</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd
                            http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context.xsd
                            http://www.springframework.org/schema/aop http://www.springframework.org/schema/aop/spring-aop.xsd
                            http://www.springframework.org/schema/tx http://www.springframework.org/schema/tx/spring-tx.xsd<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div></li> <li><p>开启事务注解</p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code>    <span class="token comment">&lt;!--开启事务注解--&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">tx:</span>annotation-driven</span> <span class="token attr-name">transaction-manager</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>transactionManager<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">tx:</span>annotation-driven</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></li> <li><p>在service类上面(获取service类里面方法上面)添加事务注解</p> <ol><li>@Transactional,这个注解添加到类上面，也可以添加到方法上面</li> <li>如果把这个注解添加到类上面，这个类里面的所有的方法都添加事务</li> <li>如果把这个注解添加到方法上面，为这个方法添加事务</li></ol></li></ol> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Service</span>
<span class="token annotation punctuation">@Transactional</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserService</span> <span class="token punctuation">{</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div></li></ol> <blockquote><p>经测试，虽然发生异常，但是事务回滚，lucy和mary的金额仍然是1000</p></blockquote> <h2 id="注解声明式事务管理参数配置"><a href="#注解声明式事务管理参数配置" class="header-anchor">#</a> 注解声明式事务管理参数配置</h2> <ol><li><p>在service类上面添加注解@Transactiona，在这个注解里面可以配置事务相关参数</p> <p><img src="data:image/png;base64,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" alt="1641288148539"></p></li></ol> <h3 id="propagation-事务传播行为"><a href="#propagation-事务传播行为" class="header-anchor">#</a> propagation：事务传播行为</h3> <ol><li><p>多事务方法直接进行调用，这个过程中事务是如何进行管理的</p> <p><img src="/Blog/assets/img/04.32904990.png" alt="1641288855859"></p></li></ol> <p>事务的传播行为可以由传播属性指定。Spring定义了7种类传播行为</p> <table><thead><tr><th>传播属性</th> <th>描述</th></tr></thead> <tbody><tr><td>REQUIRED</td> <td>如果有事务在运行，当前的方法就在这个事务内运行，否则，就启动一个新的事物，并在自己的事务内运行</td></tr> <tr><td>REQUIRED_NEW</td> <td>当前的方法必须启动新事物，并在它自己的事务内运行，如果有事务正在运行，应该将它挂起</td></tr> <tr><td>SUPPORTS</td> <td>如果有事务在运行，当前的方法就在这个事务内运行，否则它可以不运行在事务中</td></tr> <tr><td>NOT_SUPPROTS</td> <td>当前的方法不应该运行在事务中，如果有运行的事务，将它挂起</td></tr> <tr><td>MANDATORY</td> <td>当前的方法必须运行在事物内部，如果没有正在运行的事务，就抛出异常</td></tr> <tr><td>NEVER</td> <td>当前的方法不应该运行在事务中，如果有运行的事务，就抛出异常</td></tr> <tr><td>NESTED</td> <td>如果有事务在运行，当前的方法就应该在这个事务的嵌套事务内运行。否则，就启动一个新的事务，并在它自己的事务内运行</td></tr></tbody></table> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Service</span>
<span class="token annotation punctuation">@Transactional</span><span class="token punctuation">(</span>propagation <span class="token operator">=</span> <span class="token class-name">Propagation</span><span class="token punctuation">.</span>REQUIRED<span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserService</span> <span class="token punctuation">{</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h3 id="isolation-事务隔离级别"><a href="#isolation-事务隔离级别" class="header-anchor">#</a> isolation：事务隔离级别</h3> <ol><li><p>事务有特性称为隔离性，多事务操作之间不会产生影响。不考虑隔离性产生很多问题</p></li> <li><p>有三个读的问题:脏读、不可重复读、幻读</p> <ol><li><p>脏读：一个未提交事务读取到另一个 未提交事务的数据</p> <p><img src="data:image/png;base64,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" alt="1641291145696"></p></li> <li><p>不可重复读</p> <p><img src="data:image/png;base64,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" alt="1641291191857"></p></li> <li><p>幻读:一个未提交事务读取到另一个提交事务添加数据</p></li></ol></li> <li><p>通过设置事务隔离性，解决读问题</p> <table><thead><tr><th style="text-align:center;"></th> <th style="text-align:center;">脏读</th> <th style="text-align:center;">不可重复度</th> <th style="text-align:center;">幻读</th></tr></thead> <tbody><tr><td style="text-align:center;">READ UNCOMMITTED(读未提交)</td> <td style="text-align:center;">有</td> <td style="text-align:center;">有</td> <td style="text-align:center;">有</td></tr> <tr><td style="text-align:center;">READ COMMITTED(读已提交)</td> <td style="text-align:center;">无</td> <td style="text-align:center;">有</td> <td style="text-align:center;">有</td></tr> <tr><td style="text-align:center;">REPEATABLE READ(可重复读)</td> <td style="text-align:center;">无</td> <td style="text-align:center;">无</td> <td style="text-align:center;">有</td></tr> <tr><td style="text-align:center;">SERIALIZABLE(串行化)</td> <td style="text-align:center;">无</td> <td style="text-align:center;">无</td> <td style="text-align:center;">无</td></tr></tbody></table> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Service</span>
<span class="token annotation punctuation">@Transactional</span><span class="token punctuation">(</span>propagation <span class="token operator">=</span> <span class="token class-name">Propagation</span><span class="token punctuation">.</span>REQUIRED<span class="token punctuation">,</span>isolation <span class="token operator">=</span> <span class="token class-name">Isolation</span><span class="token punctuation">.</span>REPEATABLE_READ<span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserService</span> <span class="token punctuation">{</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div></li></ol> <h3 id="timeout-超时时间"><a href="#timeout-超时时间" class="header-anchor">#</a> timeout：超时时间</h3> <ol><li>事务需要在一定时间内提交，如果不提交进行回滚</li> <li>默认值是-1,设置时间以秒为单位进行计算</li></ol> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Service</span>
<span class="token annotation punctuation">@Transactional</span><span class="token punctuation">(</span>timeout <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>propagation <span class="token operator">=</span> <span class="token class-name">Propagation</span><span class="token punctuation">.</span>REQUIRED<span class="token punctuation">,</span>isolation <span class="token operator">=</span> <span class="token class-name">Isolation</span><span class="token punctuation">.</span>REPEATABLE_READ<span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserService</span> <span class="token punctuation">{</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h3 id="readonly-是否只读"><a href="#readonly-是否只读" class="header-anchor">#</a> readOnly：是否只读</h3> <ol><li>读:查询操作，写:添加修改删除操作</li> <li>readOnly默认值false,表示可以查询，可以添加修改删除操作</li> <li>设置readOnly值是true,设置成true之后，只能查询</li></ol> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Service</span>
<span class="token annotation punctuation">@Transactional</span><span class="token punctuation">(</span>readOnly <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">,</span>timeout <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>propagation <span class="token operator">=</span> <span class="token class-name">Propagation</span><span class="token punctuation">.</span>REQUIRED<span class="token punctuation">,</span>isolation <span class="token operator">=</span> <span class="token class-name">Isolation</span><span class="token punctuation">.</span>REPEATABLE_READ<span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserService</span> <span class="token punctuation">{</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h3 id="rolibackfor-回滚"><a href="#rolibackfor-回滚" class="header-anchor">#</a> rolibackFor：回滚</h3> <ul><li>设置出现哪些异常进行事务回滚</li></ul> <h3 id="norollbackfor-不回滚"><a href="#norollbackfor-不回滚" class="header-anchor">#</a> noRollbackFor：不回滚</h3> <ul><li>设置出现哪些异常不进行事务回滚</li></ul> <h2 id="xml声明式声明式事务管理-了解"><a href="#xml声明式声明式事务管理-了解" class="header-anchor">#</a> XML声明式声明式事务管理(了解)</h2> <ol><li><p>在Spring配置文件中进行配置</p> <ol><li>配置事务管理器</li> <li>配置通知</li> <li>配置切入点和切面</li></ol> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code>  <span class="token comment">&lt;!--1 创建事务管理器--&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>transactionManager<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>org.springframework.jdbc.datasource.DataSourceTransactionManager<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!--注入数据源--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>dataSource<span class="token punctuation">&quot;</span></span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>dataSource<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">&gt;</span></span>

    <span class="token comment">&lt;!--2 配置通知--&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">tx:</span>advice</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>txadvice<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!--配置事务参数--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">tx:</span>attributes</span><span class="token punctuation">&gt;</span></span>
            <span class="token comment">&lt;!--指定哪种规则的方法上面添加事务--&gt;</span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">tx:</span>method</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>accountMoney<span class="token punctuation">&quot;</span></span> <span class="token attr-name">propagation</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>REQUIRED<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
            <span class="token comment">&lt;!--&lt;tx:method name=&quot;account*&quot;/&gt;--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">tx:</span>attributes</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">tx:</span>advice</span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!--3 配置切入点和切面--&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">aop:</span>config</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!--配置切入点--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">aop:</span>pointcut</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>pt<span class="token punctuation">&quot;</span></span> <span class="token attr-name">expression</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>execution(* com.frx01.spring5.service.UserService.*(..))<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token comment">&lt;!--配置切面--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">aop:</span>advisor</span> <span class="token attr-name">advice-ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>txadvice<span class="token punctuation">&quot;</span></span> <span class="token attr-name">pointcut-ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>pt<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">aop:</span>advisor</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">aop:</span>config</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div></li></ol> <h2 id="完全注解开发"><a href="#完全注解开发" class="header-anchor">#</a> 完全注解开发</h2> <ol><li><p>创建配置类，使用配置类代替xml配置文件</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">/**
 * @author frx
 * @version 1.0
 * @date 2022/1/4  18:50
 */</span>
<span class="token annotation punctuation">@Configuration</span><span class="token comment">//配置类</span>
<span class="token annotation punctuation">@ComponentScan</span><span class="token punctuation">(</span>basePackages <span class="token operator">=</span> <span class="token string">&quot;com.frx01&quot;</span><span class="token punctuation">)</span><span class="token comment">//组件扫描</span>
<span class="token annotation punctuation">@EnableTransactionManagement</span><span class="token comment">//开启事务</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TxConfig</span> <span class="token punctuation">{</span>

    <span class="token comment">//创建数据库连接池</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">DruidDataSource</span> <span class="token function">getDruidDataSource</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>

        <span class="token class-name">DruidDataSource</span> dataSource <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DruidDataSource</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        dataSource<span class="token punctuation">.</span><span class="token function">setDriverClassName</span><span class="token punctuation">(</span><span class="token string">&quot;com.mysql.jdbc.Driver&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        dataSource<span class="token punctuation">.</span><span class="token function">setUrl</span><span class="token punctuation">(</span><span class="token string">&quot;jdbc:mysql:///user_db&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        dataSource<span class="token punctuation">.</span><span class="token function">setUsername</span><span class="token punctuation">(</span><span class="token string">&quot;root&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        dataSource<span class="token punctuation">.</span><span class="token function">setPassword</span><span class="token punctuation">(</span><span class="token string">&quot;hsp&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> dataSource<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//Jdbc模板对象</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">JdbcTemplate</span> <span class="token function">getJdbcTemplate</span><span class="token punctuation">(</span><span class="token class-name">DataSource</span> dataSource<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">//到ioc容器中根据类型找到dataSource</span>
        <span class="token class-name">JdbcTemplate</span> jdbcTemplate <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">JdbcTemplate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//注入dataSource</span>
        jdbcTemplate<span class="token punctuation">.</span><span class="token function">setDataSource</span><span class="token punctuation">(</span>dataSource<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span>  jdbcTemplate<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//创建事务事务管理器</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">DataSourceTransactionManager</span> <span class="token function">getDataSourceTransactionManager</span><span class="token punctuation">(</span><span class="token class-name">DataSource</span> dataSource<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">DataSourceTransactionManager</span> transactionManager <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DataSourceTransactionManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        transactionManager<span class="token punctuation">.</span><span class="token function">setDataSource</span><span class="token punctuation">(</span>dataSource<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> transactionManager<span class="token punctuation">;</span>

    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br></div></div><ul><li><p>测试</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code>    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span>  <span class="token function">testAccount3</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">ApplicationContext</span> context <span class="token operator">=</span>
                <span class="token keyword">new</span> <span class="token class-name">AnnotationConfigApplicationContext</span><span class="token punctuation">(</span><span class="token class-name">TxConfig</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">UserService</span> userService <span class="token operator">=</span> context<span class="token punctuation">.</span><span class="token function">getBean</span><span class="token punctuation">(</span><span class="token string">&quot;userService&quot;</span><span class="token punctuation">,</span> <span class="token class-name">UserService</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        userService<span class="token punctuation">.</span><span class="token function">accountMoney</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div></li></ul></li></ol></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/Blog/studynotes/Spring5/JdbcTemplate.html" class="prev">
        Jdbc Template
      </a></span> <span class="next"><a href="/Blog/studynotes/Spring5/Spring5新功能.html">
        Spring5 新功能
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/Blog/assets/js/app.8c5833f4.js" defer></script><script src="/Blog/assets/js/3.65910f85.js" defer></script><script src="/Blog/assets/js/44.31c4d3cb.js" defer></script><script src="/Blog/assets/js/71.87eb04f3.js" defer></script>
  </body>
</html>
